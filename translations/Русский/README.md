# SA-MP Injector

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)
[![SA-MP | OMP](https://img.shields.io/badge/Support-SA--MP%20%7C%20OMP-yellow)](https://github.com/spc-samp/samp-injector)
[![x86 Only](https://img.shields.io/badge/Architecture-x86%20(32--bit)-orange)](https://github.com/spc-samp/samp-injector)

SA-MP Injector — это универсальный инструмент, разработанный для **SA-MP (San Andreas Multiplayer)** и **OMP (Open Multiplayer)**, функционирующий как **исполняемый файл командной строки** и как **библиотека для различных языков программирования**. Его основная функция — инъекция `samp.dll` (для **SA-MP**) или одновременно `samp.dll` и `omp-client.dll` (для **OMP**) в процесс **GTA:SA**, что позволяет запускать игру с настраиваемыми параметрами для прямого подключения к серверу.

## Языки

- Português: [README](../../)
- Deutsch: [README](../Deutsch/README.md)
- English: [README](../English/README.md)
- Español: [README](../Espanol/README.md)
- Français: [README](../Francais/README.md)
- Italiano: [README](../Italiano/README.md)
- Polski: [README](../Polski/README.md)
- Svenska: [README](../Svenska/README.md)
- Türkçe: [README](../Turkce/README.md)

## Оглавление

- [SA-MP Injector](#sa-mp-injector)
  - [Языки](#языки)
  - [Оглавление](#оглавление)
  - [Исполняемый файл](#исполняемый-файл)
    - [Функциональность](#функциональность)
    - [Как использовать (Командная строка)](#как-использовать-командная-строка)
      - [Режим SA-MP](#режим-sa-mp)
      - [Режим OMP](#режим-omp)
      - [Параметры](#параметры)
    - [Как использовать (Встроенный в приложения)](#как-использовать-встроенный-в-приложения)
    - [Использование библиотеки C++ в исполняемом файле](#использование-библиотеки-c-в-исполняемом-файле)
    - [Как компилировать](#как-компилировать)
      - [Требования](#требования)
      - [Шаги компиляции](#шаги-компиляции)
  - [Библиотеки](#библиотеки)
    - [Обзор](#обзор)
    - [Список библиотек](#список-библиотек)
  - [Лицензия](#лицензия)
    - [Условия использования](#условия-использования)
      - [1. Предоставленные разрешения](#1-предоставленные-разрешения)
      - [2. Обязательные условия](#2-обязательные-условия)
      - [3. Авторские права](#3-авторские-права)
      - [4. Отказ от гарантий и ограничение ответственности](#4-отказ-от-гарантий-и-ограничение-ответственности)

## Исполняемый файл

Исполняемый файл `samp-injector.exe` предоставляет интерфейс командной строки для запуска **GTA:SA** с **SA-MP** или **OMP**, автоматически настраивая подключение к серверу. Он инкапсулирует логику **инъекции DLL** и передачи параметров игры.

### Функциональность

`samp-injector.exe` действует как автоматизированный клиент для запуска игры, абстрагируя сложность конфигурации и инъекции **DLL**:

1. **Проверка окружения:** Проверяет наличие необходимых файлов (`gta_sa.exe`, `samp.dll`, `omp-client.dll`) в указанной директории, а также валидность предоставленных параметров подключения.
2. **Создание приостановленного процесса:** Запускает `gta_sa.exe` в приостановленном состоянии, что является предварительным условием для **безопасной инъекции DLL** до выполнения основного процесса игры.
3. **Динамическая инъекция DLL:**
    - В режиме **SA-MP** инъектируется `samp.dll`.
    - В режиме **OMP** инъектируются `samp.dll` и `omp-client.dll`.
    Инъекция осуществляется через удалённый вызов функции `LoadLibraryA`, что позволяет GTA: SA загрузить модули мультиплеера и инициировать подключение.
4. **Конфигурация аргументов:** Аргументы командной строки, такие как **никнейм**, **IP-адрес сервера**, **порт** и **пароль (если указан)**, подготавливаются и передаются в `gta_sa.exe`.
5. **Возобновление процесса:** После **успешной инъекции DLL** процесс игры возобновляется для нормального выполнения, что позволяет **GTA:SA** напрямую подключиться к серверу.

### Как использовать (Командная строка)

Для использования исполняемого файла вызовите его из **Командной строки (CMD)**, **PowerShell** или **терминала**, указав необходимые параметры.

Базовый формат:

```bash
samp-injector.exe <режим> <директория_игры> <никнейм> <IP_сервера> <порт_сервера> <пароль_сервера (опционально)>
```

#### Режим SA-MP

Для инъекции только `samp.dll`:

```bash
samp-injector.exe "samp" "C:\Games\GTA San Andreas" "Имя" "127.0.0.1" "7777" "пароль (опционально)"
```

#### Режим OMP

Для инъекции `samp.dll` и `omp-client.dll`:

```bash
samp-injector.exe "omp" "C:\Games\GTA San Andreas" "Имя" "127.0.0.1" "7777" "пароль (опционально)"
```

#### Параметры

- `<режим>`: Определяет тип инъекции.
    - `samp`: Для **SA-MP** (`samp.dll`).
    - `omp`: Для **OMP** (`samp.dll` и `omp-client.dll`).
- `<директория_игры>`: Полный путь к директории **GTA:SA**. Эта директория должна содержать `gta_sa.exe` и соответствующие файлы **DLL**.
- `<никнейм>`: Ваш никнейм в игре (максимум **20 символов**).
- `<IP_сервера>`: **IP-адрес** или **доменное имя** сервера.
- `<порт_сервера>`: Порт подключения сервера (**числовое значение** от **1** до **65535**).
- `<пароль_сервера>`: Пароль, необходимый для подключения к серверу **(если сервер не требует пароля, этот параметр можно не указывать)**.

Если аргументы неверны или недостаточны, отобразится сообщение об использовании.

### Как использовать (Встроенный в приложения)

`samp-injector.exe` идеально подходит для интеграции в сторонние приложения, такие как пользовательские лаунчеры, которые хотят автоматизировать процесс запуска игры с предопределёнными настройками.

Пример вызова `samp-injector.exe` из приложения на **C#**:

```csharp
using System;
using System.Diagnostics;
using System.Windows.Forms;

public class Launcher {
    public static void Main(string[] args) {
        string inject_mode = "omp"; 
        string folder = "C:\\Games\\GTA San Andreas";
        string nickname = "Имя";
        string ip = "127.0.0.1";
        string port = "7777";
        string password = "пароль (опционально)";

        try {
            string arguments = $"{inject_mode} \"{folder}\" \"{nickname}\" \"{ip}\" {port}";

            if (!string.IsNullOrEmpty(password))
                arguments += $" \"{password}\"";

            ProcessStartInfo start_info = new ProcessStartInfo {
                FileName = "samp-injector.exe", 
                Arguments = arguments,
                UseShellExecute = false,
                CreateNoWindow = true 
            };

            using (Process process = Process.Start(start_info)) {
                process.WaitForExit(); 

                if (process.ExitCode != 0)
                    MessageBox.Show($"SA-MP Injector вернул ошибку (Код: {process.ExitCode}). Игра могла не запуститься корректно.", "Ошибка запуска", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }
        catch (Exception ex) {
            MessageBox.Show($"Произошла ошибка при запуске игры: {ex.Message}", "Ошибка", MessageBoxButtons.OK, MessageBoxIcon.Error);
        }
    }
}
```

### Использование библиотеки C++ в исполняемом файле

Исполняемый файл `samp-injector.exe` построен на основе библиотеки [SA-MP Injector C++](https://github.com/spc-samp/samp-injector/tree/main/libraries/cpp), которая находится в директории `libraries/cpp/`. Файл `main.cpp` исполняемого файла использует функциональность этой библиотеки для выполнения инъекции и запуска игры.

Основной заголовочный файл библиотеки **C++**, который необходимо включить, — это `libraries/samp-injector/cpp/injector.hpp`. Поскольку библиотека [SA-MP Injector C++](https://github.com/spc-samp/samp-injector/tree/main/libraries/cpp) является **header-only**, её использование требует только включения этого заголовка в исходный код, без необходимости связывания с файлом `.lib`.

Соответствующий фрагмент `main.cpp`, демонстрирующий интеграцию, выглядит следующим образом:

```cpp
// Извлекает аргументы командной строки
int argc;
std::unique_ptr<LPWSTR[], decltype(&LocalFree)> argv(CommandLineToArgvW(GetCommandLineW(), &argc), &LocalFree);

// ... (проверка количества аргументов и режима инъекции) ...

// Извлекает параметры в переменные типа wide string
std::wstring folder = argv[2];
std::wstring nickname = argv[3];
std::wstring ip = argv[4];
std::wstring port = argv[5];
std::wstring password = (argc == 7) ? argv[6] : L"";

// Делегирует логику инъекции функции "Initialize_Game" из библиотеки
// Обратите внимание, что "injector.hpp" был предварительно включён в "main.cpp"
if (!Initialize_Game(inject_type, folder, nickname, ip, port, password))
    return 1;

Sleep(10000); // Ожидание перед завершением исполняемого файла
```

Функция `Initialize_Game` действует как высокоуровневый интерфейс библиотеки, координируя все операции по проверке, созданию процесса и **инъекции DLL**.

### Как компилировать

Вы можете скомпилировать `samp-injector.exe` из исходного кода. Если вы не хотите компилировать, вы можете скачать предварительно собранные версии в разделе [Releases](https://github.com/spc-samp/samp-injector/releases).

#### Требования

- **Visual Studio:** Рекомендуется **Visual Studio 2022** или выше с установленной рабочей нагрузкой **"Разработка для настольных приложений на C++"**.
- **Git:** Для клонирования репозитория (или просто скачайте по этой ссылке: [Скачать](https://github.com/spc-samp/samp-injector/archive/refs/heads/main.zip)).

#### Шаги компиляции

1. **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/spc-samp/samp-injector.git
    cd samp-injector
    ```
2. **Откройте решение:**
   
    Перейдите в папку `executable` и откройте файл решения `.sln`:
    ```bash
    cd executable
    start samp-injector.sln
    ```
    Это откроет проект в **Visual Studio**.
3. **Настройте сборку:**
    - В **Visual Studio** проверьте конфигурацию решения. Рекомендуется использовать режимы `Release` и `x86` **(32 бита)**. В контексте **GTA:SA** и **SA-MP**/**OMP** архитектура **x86 (32 бита)** является обязательной.
4. **Скомпилируйте:**
   - В меню `Сборка` выберите `Скомпилировать решение` или `Скомпилировать samp-injector`.
   - Альтернативно можно использовать сочетания клавиш:
     - `Ctrl + Shift + B` для компиляции всего решения.
     - `Ctrl + B` (если настроено) для компиляции текущего проекта.
    - Если всё настроено правильно, исполняемый файл `samp-injector.exe` будет создан в директории `executable\Release` (или `executable\Debug`, в зависимости от конфигурации **сборки**).

## Библиотеки

Библиотеки являются основными компонентами `SA-MP Injector`, содержащими основную логику для управления процессами, **инъекции DLL** и проверки параметров. Главное преимущество использования этих библиотек — простота инициализации и инъекции, обычно через одну функцию (или вызовы с определёнными параметрами для языков сценариев).

### Обзор

Проект основан на библиотеках, которые инкапсулируют критически важные функции. Это позволяет другим проектам легко интегрировать возможность запуска **GTA:SA** с необходимыми модулями **мультиплеера**.

### Список библиотек

| Язык          | Название                   | Ссылка на библиотеку/документацию           |
| ------------- | -------------------------- | ------------------------------------------- |
| C++           | **SA-MP Injector C++**     | [Ознакомьтесь с библиотекой](libraries/cpp) |
| C             | **SA-MP Injector C**       | (Скоро)                                     |
| C#            | **SA-MP Injector C#**      | (Скоро)                                     |
| Java          | **SA-MP Injector Java**    | (Скоро)                                     |
| Python        | **SA-MP Injector Python**  | (Скоро)                                     |
| Go (Golang)   | **SA-MP Injector Go**      | (Скоро)                                     |
| Rust          | **SA-MP Injector Rust**    | (Скоро)                                     |
| Kotlin        | **SA-MP Injector Kotlin**  | (Скоро)                                     |
| Scala         | **SA-MP Injector Scala**   | (Скоро)                                     |
| Lua           | **SA-MP Injector Lua**     | (Скоро)                                     |
| Ruby          | **SA-MP Injector Ruby**    | (Скоро)                                     |
| Visual Basic  | **SA-MP Injector VB**      | (Скоро)                                     |
| F#            | **SA-MP Injector F#**      | (Скоро)                                     |
| Pascal/Delphi | **SA-MP Injector P/D**     | (Скоро)                                     |
| PowerShell    | **SA-MP Injector PS**      | (Скоро)                                     |
| D (Dlang)     | **SA-MP Injector D**       | (Скоро)                                     |
| Nim           | **SA-MP Injector Nim**     | (Скоро)                                     |
| Zig           | **SA-MP Injector Zig**     | (Скоро)                                     |
| V (VLang)     | **SA-MP Injector V**       | (Скоро)                                     |
| Crystal       | **SA-MP Injector Crystal** | (Скоро)                                     |
| Perl          | **SA-MP Injector Perl**    | (Скоро)                                     |
| Racket (Lisp) | **SA-MP Injector Racket**  | (Скоро)                                     |
| Haskell       | **SA-MP Injector Haskell** | (Скоро)                                     |
| OCaml         | **SA-MP Injector OCaml**   | (Скоро)                                     |

> [!TIP]
> Подробная документация для каждой библиотеки будет доступна в её **соответствующей директории**.

## Лицензия

Copyright © **SA-MP Programming Community**

Данное программное обеспечение лицензируется в соответствии с условиями лицензии MIT ("Лицензия"); вы можете использовать это программное обеспечение в соответствии с условиями Лицензии. Копию Лицензии можно получить по адресу: [MIT License](https://opensource.org/licenses/MIT)

### Условия использования

#### 1. Предоставленные разрешения

Настоящая лицензия бесплатно предоставляет любому лицу, получающему копию данного программного обеспечения и связанных с ним файлов документации, следующие права:
* Использовать, копировать, изменять, объединять, публиковать, распространять, сублицензировать и/или продавать копии программного обеспечения без ограничений
* Разрешать лицам, которым предоставляется программное обеспечение, делать то же самое при соблюдении указанных ниже условий

#### 2. Обязательные условия

Все копии или существенные части программного обеспечения должны включать:
* Вышеуказанное уведомление об авторских правах
* Данное уведомление о разрешении
* Приведенное ниже заявление об отказе от ответственности

#### 3. Авторские права

Программное обеспечение и вся связанная с ним документация защищены законами об авторских правах. **SA-MP Programming Community** сохраняет за собой оригинальные авторские права на программное обеспечение.

#### 4. Отказ от гарантий и ограничение ответственности

ПРОГРАММНОЕ ОБЕСПЕЧЕНИЕ ПРЕДОСТАВЛЯЕТСЯ "КАК ЕСТЬ", БЕЗ КАКИХ-ЛИБО ГАРАНТИЙ, ЯВНЫХ ИЛИ ПОДРАЗУМЕВАЕМЫХ, ВКЛЮЧАЯ, НО НЕ ОГРАНИЧИВАЯСЬ ГАРАНТИЯМИ ТОВАРНОЙ ПРИГОДНОСТИ, ПРИГОДНОСТИ ДЛЯ КОНКРЕТНОЙ ЦЕЛИ И НЕНАРУШЕНИЯ ПРАВ.

НИ ПРИ КАКИХ ОБСТОЯТЕЛЬСТВАХ АВТОРЫ ИЛИ ПРАВООБЛАДАТЕЛИ НЕ НЕСУТ ОТВЕТСТВЕННОСТИ ЗА ЛЮБЫЕ ПРЕТЕНЗИИ, УБЫТКИ ИЛИ ИНУЮ ОТВЕТСТВЕННОСТЬ, БУДЬ ТО В СИЛУ ДОГОВОРА, ДЕЛИКТА ИЛИ ИНЫМ ОБРАЗОМ, ВОЗНИКАЮЩИЕ ИЗ, ИЗ-ЗА ИЛИ В СВЯЗИ С ПРОГРАММНЫМ ОБЕСПЕЧЕНИЕМ ИЛИ ИСПОЛЬЗОВАНИЕМ ИЛИ ИНЫМИ ДЕЙСТВИЯМИ С ПРОГРАММНЫМ ОБЕСПЕЧЕНИЕМ.

---

Для подробной информации о лицензии MIT посетите: https://opensource.org/licenses/MIT